# virus-info
---
## Overview

The `virus-info` subcommand identifies and reports details on potential segmented viruses based on their taxonomy. It cross-references a user-supplied taxonomy file with a segmented viruses database and a genome type database to predict the genome structure and type for each contig. Additionally, it outputs information for further investigation if a high fraction of viruses within a taxon are segmented.

### What It Does

1. **Load Databases**  
   - **Segmented Viruses Database:** Loaded from `segmented_viruses.tsv`.
   - **Genome Type Database:** Loaded from `genome_types.tsv`.
   - **Taxonomy Database:** Constructed using the `nodes.dmp` and `names.dmp` files via the `taxopy` package.

2. **Process Each Taxonomy Record**  
   For each contig in the taxonomy file:
   - If the taxonomy is `"unclassified viruses"`, a minimal record is created (genome type set as "uncharacterized" and structure as "undetermined").
   - Otherwise, it retrieves the lineage for the taxon (after stripping a potential trailing `" sp."`), and searches first for a segmented virus record.  
     - If found and the segmented fraction is high, extra details are echoed to the terminal.
   - Next, it searches for the corresponding genome type record.
   - It then deduces the predicted genome structure:
     - `"segmented"` if segmented_fraction is 100,
     - `"undetermined"` if segmented_fraction is > 0 but less than 100,
     - `"non-segmented"` otherwise.
   - Finally, it combines this information to build a record for output.

3. **Generate Output Files**  
   - **miuvig_taxonomy.tsv**: Contains contigs with their predicted genome type and structure.
   - **segmented_viruses_info.tsv**: If any segmented virus records were found, details from the segmented viruses database are saved to this file.
   - During processing, the command also echoes warnings if certain taxa are not found in the official ICTV taxonomy.

---
## Required Input

- **-\\\-taxonomy**:  
  Path to the taxonomy file (TSV). This file should contain columns at least for "contig" and "taxonomy". For example, it might be generated by the [`suvtk taxonomy`](taxonomy.md) subcommand.

- **-d, -\\\-database**:  
  The directory path to the suvtk database. This directory must contain the following files:
  - `nodes.dmp`
  - `names.dmp`

- **-o, -\\\-output**:  
  The output directory path where the results will be saved. If the directory does not exist, it will be created.

## Output Files

- `miuvig_taxonomy.tsv`:
  - Columns: `contig`, `pred_genome_type`, `pred_genome_struc`
  - This file lists each contig with its predicted genome type and structure.

- `segmented_viruses_info.tsv`:
  - Contains detailed information on segmented virus records (if any were found) sorted by the segmented fraction.

## Example Usage

Below is an example command-line invocation:

```bash
suvtk virus-info --taxonomy taxonomy.tsv --database /path/to/database --output output_dir
```

This command will process the `taxonomy.tsv` file, using the databases in `/path/to/database`, and write the results (e.g., `miuvig_taxonomy.tsv` and `segmented_viruses_info.tsv`) to the `output_dir`.

## Additional Notes

- If a contigâ€™s taxonomy is not part of the official ICTV taxonomy, the predicted genome type will default to `"uncharacterized"` and its structure to `"undetermined"`.
- For taxa where a high percentage of viruses are segmented, additional information (such as the range of segments and the majority segment count) is echoed for further inspection.